<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Diabetes Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root{
      --bg-main:#020617;
      --bg-glass:rgba(255,255,255,0.07);
      --border-soft:rgba(255,255,255,0.15);
      --neon-blue:#38bdf8;
      --neon-purple:#a78bfa;
      --neon-green:#4ade80;
      --neon-yellow:#facc15;
      --neon-red:#fb7185;
      --radius-lg:20px;
      --radius-md:14px;
    }

    *{ box-sizing:border-box; font-family:"Orbitron", system-ui, sans-serif; }

    body{
      margin:0; padding:14px; min-height:100vh;
      background:radial-gradient(800px 400px at top,#1e293b,transparent),
                 radial-gradient(600px 300px at bottom,#0f172a,transparent),
                 var(--bg-main);
      color:#e5e7eb; font-size:16px;
    }

    header{text-align:center; margin-bottom:14px;}
    header h1{ margin:0; font-size:26px; font-weight:800; background:linear-gradient(90deg,var(--neon-blue),var(--neon-purple)); -webkit-background-clip:text;color:transparent;}
    header span{ font-size:14px; color:#94a3b8;}

    main{ display:flex; flex-direction:column; gap:14px; }

    .card{
      background:linear-gradient(180deg,var(--bg-glass),rgba(255,255,255,0.02));
      border:1px solid var(--border-soft); border-radius:var(--radius-lg);
      padding:16px; backdrop-filter:blur(14px);
      box-shadow:0 10px 30px rgba(0,0,0,0.4), inset 0 0 0 1px rgba(255,255,255,0.03);
    }

    .chart{ padding:10px; }
    .chart canvas{ max-height:320px; min-width:320px; }

    .stat{text-align:center;}
    .stat p{ margin:0; font-size:14px; color:#9ca3af; }
    .stat strong{ display:block; margin-top:6px; font-size:38px; font-weight:900;
    background:linear-gradient(90deg,var(--neon-green),var(--neon-yellow),var(--neon-red)); -webkit-background-clip:text;color:transparent;}

    table{ width:100%; border-collapse:collapse; font-size:16px; }
    thead{ background:rgba(255,255,255,0.06); }
    th{ padding:10px 6px; font-weight:500; color:#9ca3af; }
    td{ padding:10px 6px; border-bottom:1px solid var(--border-soft); text-align:center; }

    .modal{
      position:fixed; inset:0; background:rgba(2,6,23,0.7); backdrop-filter:blur(6px);
      display:none; align-items:center; justify-content:center; z-index:100;
    }
    .modal-box{
      width:92%; max-width:360px;
      background:linear-gradient(180deg,rgba(15,23,42,0.95),rgba(2,6,23,0.95));
      border:1px solid var(--border-soft); border-radius:24px; padding:18px;
      box-shadow:0 0 40px rgba(56,189,248,0.25);
    }
    .modal-box h3{ margin:0 0 12px; font-size:18px; text-align:center; }
    .modal-box input, .modal-box select{ width:100%; margin-top:10px; padding:14px; border-radius:var(--radius-md); border:1px solid var(--border-soft); background:#020617; color:#fff; font-size:16px;}
    .modal-box input::placeholder{ color:#6b7280; }
    .modal-box button{ width:100%; margin-top:12px; padding:14px; border-radius:var(--radius-lg); border:none; font-weight:700; background:linear-gradient(135deg,var(--neon-blue),var(--neon-purple)); }
    .modal-box .close{ background:#020617; color:#9ca3af; border:1px solid var(--border-soft); }

    @keyframes modalIn{ from{opacity:0;transform:scale(0.92) translateY(10px);} to{opacity:1;transform:scale(1) translateY(0);} }
    @keyframes modalOut{ from{opacity:1;transform:scale(1) translateY(0);} to{opacity:0;transform:scale(0.92) translateY(10px);} }
    .modal.show{ display:flex; }
    .modal.show .modal-box{ animation:modalIn 0.25s ease-out forwards; }
    .modal.hide .modal-box{ animation:modalOut 0.2s ease-in forwards; }

    nav{position:fixed; bottom:0; width:100%; display:flex; justify-content:space-around; background:rgba(0,0,0,0.5); padding:10px 0; backdrop-filter:blur(10px);}
    nav button{ flex:1; border:none; background:none; color:#e5e7eb; font-size:22px; font-weight:700; cursor:pointer; transition:0.2s;}
    nav button:hover{ color:#38bdf8; transform:scale(1.1); }

    @media(max-width:600px){
      body{ padding:10px; font-size:18px; }
      .stat strong{ font-size:36px; }
      .chart canvas{ max-height:360px; min-width:320px; }
      table th, table td{ font-size:18px; padding:10px; }
      .modal-box input, .modal-box select, .modal-box button{ font-size:18px; padding:14px; }
      nav button{ font-size:24px; padding:14px 0; }
    }
  </style>
</head>
<body>

<header>
  <h1>Diabetes Tracker</h1>
  <span>Ø«Ø¨Øª Ù‚Ù†Ø¯ Ùˆ Ø§Ù†Ø³ÙˆÙ„ÛŒÙ†</span>
</header>

<main>

  <section class="card stat">
    <p>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚Ù†Ø¯</p>
    <strong id="average">---</strong>
  </section>

  <section class="card chart">
    <div style="overflow-x:auto;">
      <canvas id="chart"></canvas>
    </div>
  </section>

  <section class="card full">
    <button onclick="exportPDF()" style="margin-bottom:10px;">ğŸ“„ Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF</button>
    <h2>Ø³ÙˆØ§Ø¨Ù‚ Ù‚Ù†Ø¯ Ø®ÙˆÙ†</h2>
    <table>
      <thead><tr><th>ØªØ§Ø±ÛŒØ®</th><th>Ø³Ø§Ø¹Øª</th><th>Ø²Ù…Ø§Ù†</th><th>Ù‚Ù†Ø¯</th><th>ØªÙˆØ¶ÛŒØ­</th></tr></thead>
      <tbody id="sugarTableBody"></tbody>
    </table>
  </section>

  <section class="card full">
    <h2>Ø³ÙˆØ§Ø¨Ù‚ Ø§Ù†Ø³ÙˆÙ„ÛŒÙ†</h2>
    <table>
      <thead><tr><th>ØªØ§Ø±ÛŒØ®</th><th>Ø³Ø§Ø¹Øª</th><th>Ù†ÙˆØ¹</th><th>Ø²Ù…Ø§Ù†</th><th>ÙˆØ§Ø­Ø¯</th><th>ØªÙˆØ¶ÛŒØ­</th></tr></thead>
      <tbody id="insulinTableBody"></tbody>
    </table>
  </section>

</main>

<div id="sugarModal" class="modal">
  <div class="modal-box">
    <h3>Ø«Ø¨Øª Ù‚Ù†Ø¯</h3>
    <select id="timeModal">
      <option>ØµØ¨Ø­</option>
      <option>Ù†Ø§Ù‡Ø§Ø±</option>
      <option>Ø¹ØµØ±</option>
      <option>Ø´Ø¨</option>
    </select>
    <input type="number" id="sugarModalInput" min="40" max="600" placeholder="mg/dl">
    <input type="text" id="noteSugarModal" placeholder="ØªÙˆØ¶ÛŒØ­">
    <button onclick="addSugarModal()">Ø«Ø¨Øª</button>
    <button class="close" onclick="closeModal()">Ø¨Ø³ØªÙ†</button>
  </div>
</div>

<div id="insulinModal" class="modal">
  <div class="modal-box">
    <h3>Ø«Ø¨Øª Ø§Ù†Ø³ÙˆÙ„ÛŒÙ†</h3>
    <select id="insulinTypeModal">
      <option>Ù†ÙˆÙˆØ±Ù¾ÛŒØ¯</option>
      <option>ØªÙˆÚ˜Ø¦Ùˆ</option>
    </select>
    <select id="insulinTimeModal">
      <option>ØµØ¨Ø­</option>
      <option>Ù†Ø§Ù‡Ø§Ø±</option>
      <option>Ø´Ø¨</option>
    </select>
    <input type="number" id="unitsModal" min="0" max="60" placeholder="ÙˆØ§Ø­Ø¯">
    <input type="text" id="noteInsulinModal" placeholder="ØªÙˆØ¶ÛŒØ­">
    <button onclick="addInsulinModal()">Ø«Ø¨Øª</button>
    <button class="close" onclick="closeModal()">Ø¨Ø³ØªÙ†</button>
  </div>
</div>

<nav>
  <button onclick="openModal('sugarModal')">ğŸ¬ Ù‚Ù†Ø¯</button>
  <button onclick="openModal('insulinModal')">ğŸ’‰ Ø§Ù†Ø³ÙˆÙ„ÛŒÙ†</button>
</nav>

<script>
let sugars = JSON.parse(localStorage.getItem("sugars"))||[];
let insulins = JSON.parse(localStorage.getItem("insulins"))||[];
let chart;
const sugarTableBody=document.getElementById("sugarTableBody");
const insulinTableBody=document.getElementById("insulinTableBody");
const average=document.getElementById("average");
const ctx=document.getElementById("chart");

function nowDate(){return new Date().toLocaleDateString("fa-IR")}
function nowTime(){return new Date().toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}

function openModal(id){
  const m=document.getElementById(id);
  m.style.display="flex"; m.classList.remove("hide"); m.classList.add("show");
}
function closeModal(){
  document.querySelectorAll(".modal").forEach(m=>{
    m.classList.add("hide");
    setTimeout(()=>{m.classList.remove("show","hide"); m.style.display="none";},200);
  });
}

function addSugarModal(){
  const v=+document.getElementById("sugarModalInput").value;
  if(!v) return;
  const time=document.getElementById("timeModal").value;
  const note=document.getElementById("noteSugarModal").value;
  sugars.push({date:nowDate(),hour:nowTime(),time,value:v,note});
  localStorage.setItem("sugars",JSON.stringify(sugars));
  document.getElementById("sugarModalInput").value="";
  document.getElementById("noteSugarModal").value="";
  closeModal();
  render();
}

function addInsulinModal(){
  const type=document.getElementById("insulinTypeModal").value;
  const time=document.getElementById("insulinTimeModal").value;
  const units=+document.getElementById("unitsModal").value;
  const note=document.getElementById("noteInsulinModal").value;
  if(!units) return;
  insulins.push({date:nowDate(),hour:nowTime(),type,time,units,note});
  localStorage.setItem("insulins",JSON.stringify(insulins));
  document.getElementById("unitsModal").value="";
  document.getElementById("noteInsulinModal").value="";
  closeModal();
  render();
}

function avg(){ if(!sugars.length) return "---"; return Math.round(sugars.reduce((a,b)=>a+b.value,0)/sugars.length); }

function sugarColor(v){
  if(v<140) return "#4ade80";
  if(v<180) return "#facc15";
  return "#fb7185";
}

function renderTables(){
  sugarTableBody.innerHTML="";
  sugars.forEach((s)=>{
    sugarTableBody.innerHTML+=`<tr>
      <td>${s.date}</td><td>${s.hour}</td><td>${s.time}</td>
      <td style="color:${sugarColor(s.value)}; font-weight:700">${s.value}</td>
      <td>${s.note||"-"}</td>
    </tr>`;
  });
  insulinTableBody.innerHTML="";
  insulins.forEach((i)=>{
    insulinTableBody.innerHTML+=`<tr>
      <td>${i.date}</td><td>${i.hour}</td><td>${i.type}</td><td>${i.time}</td>
      <td>${i.units}</td><td>${i.note||"-"}</td>
    </tr>`;
  });
}

function drawChart(){
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:"line",
    data:{
      labels:sugars.map((_,i)=>i+1),
      datasets:[{
        data:sugars.map(s=>s.value),
        borderColor:"#38bdf8",
        tension:0.4,
        pointRadius:6,
        pointHoverRadius:8,
        pointBackgroundColor:sugars.map(s=>sugarColor(s.value)),
        pointBorderColor:"#020617",
        pointBorderWidth:2
      }]
    },
    options:{plugins:{legend:{display:false}}, scales:{y:{min:40,max:300,grid:{color:"rgba(255,255,255,0.05)"}}}}
  });
}

function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({orientation:"portrait", unit:"mm", format:"a4"});
  doc.setFontSize(16); doc.text("Ú¯Ø²Ø§Ø±Ø´ Ø¯ÛŒØ§Ø¨Øª", 105, 15, {align:"center"});
  doc.setFontSize(12); doc.text(`Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚Ù†Ø¯: ${avg()}`, 10, 25);
  let y=35; doc.setFontSize(10);
  sugars.forEach((s,i)=>{
    let color=sugarColor(s.value);
    doc.setTextColor(parseInt(color.slice(1,3),16),parseInt(color.slice(3,5),16),parseInt(color.slice(5,7),16));
    doc.text(`${i+1}) ${s.date} | ${s.hour} | ${s.time} | Ù‚Ù†Ø¯: ${s.value} | ${s.note||"-"}`,10,y);
    y+=6;if(y>280){doc.addPage();y=20;}
  });
  doc.setTextColor(0,0,0); y+=6;
  insulins.forEach((i,j)=>{
    doc.text(`${j+1}) ${i.date} | ${i.hour} | ${i.type} | ${i.time} | ${i.units}u | ${i.note||"-"}`,10,y);
    y+=6;if(y>280){doc.addPage();y=20;}
  });
  doc.save("diabetes-report.pdf");
}

function render(){average.innerText=avg(); renderTables(); drawChart();}
render();
</script>

</body>
</html>
